name: Deploy to Local ResearchSpace (self-hosted)

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  deploy:
    # Requires a self-hosted runner installed on your Windows machine
    runs-on: self-hosted
    steps:
      - name: Print context
        shell: powershell
        run: |
          Write-Host "Actor: $env:RUNNER_NAME on $env:RUNNER_OS"

      - name: Update runtime-data from origin/main
        shell: powershell
        run: |
          $target = 'C:\\Users\\matte\\researchspace-docker-desktop-main\\researchspace-docker-desktop-main\\researchspace\\runtime-data'
          git -C $target fetch origin
          git -C $target reset --hard origin/main

      - name: Restart ResearchSpace service
        shell: powershell
        run: |
          $root = 'C:\\Users\\matte\\researchspace-docker-desktop-main\\researchspace-docker-desktop-main'
          Set-Location $root
          docker compose ps researchspace
          docker compose restart researchspace

      - name: Show service status
        shell: powershell
        run: |
          $root = 'C:\\Users\\matte\\researchspace-docker-desktop-main\\researchspace-docker-desktop-main'
          Set-Location $root
          docker compose ps researchspace
